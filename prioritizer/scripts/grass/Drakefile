
LOCATION_PATH="/home/klsvd/GRASSDATA/DV"
PERMANENT=$[LOCATION_PATH]/PERMANENT

RASTER_RESOLUTION=150


$[PERMANENT], %createDB <- [-timecheck]
    ./createDB.sh $[LOCATION_PATH] 
    export GRASS_BATCH_JOB="./setDefaultRegion.sh"
    grass $[PERMANENT]
    unset GRASS_BATCH_JOB
    
set_resolution.log, %set_resolution <- $[PERMANENT] [-timecheck]
    grass ~/GRASSDATA/DV/PERMANENT/ <<EOF             
        g.region res=$RASTER_RESOLUTION -p > $[OUTPUT]
    EOF


; Импорт исходных данных
import_roads.log, %import_roads, %import_vector, %import_all <- $[PERMANENT] [-timecheck]
    export GRASS_BATCH_JOB="./import_roads.sh"
    grass $[PERMANENT] 2> $[OUTPUT]
    unset GRASS_BATCH_JOB

import_vud.log, %import_vud, %import_vector, %import_all <- $[PERMANENT] [-timecheck]
    export GRASS_BATCH_JOB="./import_vud.sh"
    grass $[PERMANENT] 2> $[OUTPUT]
    unset GRASS_BATCH_JOB



; Растеризация
rasterize_roads.log, %rasterize_roads, %raster_operations <- %import_roads, set_resolution.log, %set_resolution
    export GRASS_BATCH_JOB="./vect_roads_to_rast.sh"
    grass $[PERMANENT] 2> $[OUTPUT]
    unset GRASS_BATCH_JOB

rasterize_vud.log, %rasterize_vud, %raster_operations <- %import_vud, set_resolution.log, %set_resolution
    export GRASS_BATCH_JOB="./vect_vud_to_rast.sh"
    grass $[PERMANENT] 2> $[OUTPUT]
    unset GRASS_BATCH_JOB



; Рассчет расстояний
dist_to_roads.log, %dist_to_roads, %raster_operations <- rasterize_roads.log, %rasterize_roads, set_resolution.log
    export GRASS_BATCH_JOB="./dist_to_roads.sh"
    grass $[PERMANENT] 2> $[OUTPUT]
    unset GRASS_BATCH_JOB



